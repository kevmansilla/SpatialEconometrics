---
output: 
    pdf_document:
      latex_engine: xelatex
      toc: no
      number_sections: true
csl: apa.csl
bibliography: references.bib
header-includes:
   - \usepackage{times} 
   - \usepackage{amsmath}
   - \usepackage{amsfonts}
   - \usepackage{amssymb}
   - \usepackage{graphicx}
   - \usepackage{cancel}
   - \usepackage{natbib}
   - \usepackage{float}
   - \usepackage{multirow}
   - \usepackage{framed}
   - \usepackage{amsthm}
   - \usepackage{enumerate}
   - \usepackage{textgreek}
   - \usepackage{caption}
   - \usepackage{multirow}
   - \usepackage{epstopdf}
   - \usepackage{capt-of}
   - \usepackage{booktabs}
   - \usepackage{subfigure}
   - \usepackage{array}
   - \usepackage{lscape}
   - \usepackage{dcolumn}
   - \usepackage{titling}
   - \renewcommand{\rmdefault}{phv} 
   - \renewcommand{\sfdefault}{phv}
   - \renewcommand{\baselinestretch}{2}
   - \renewcommand{\contentsname}{\'Indice}
   - \renewcommand{\listfigurename}{\'Indice de Figuras}
   - \renewcommand{\listtablename}{\'Indice de Tablas}
   - \renewcommand{\figurename}{Figura}
   - \renewcommand{\tablename}{Tabla}
 

fig_caption: true
geometry: top=3cm, bottom=3cm, left=3cm, right=3cm 
fontsize: 12pt
urlcolor: blue
linkcolor: black
citecolor: black

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
<!-- \pagestyle{empty} -->
<!-- \begin{titlepage} -->
<!-- \begin{center} -->
<!-- \begin{huge} -->
<!-- Facultad de Ciencias Económicas \\ -->
<!-- \end{huge} -->
<!-- \medskip -->
<!-- \begin{LARGE} -->
<!-- Universidad Nacional De Córdoba \\ -->
<!-- \end{LARGE} -->
<!-- \medskip -->
<!-- \begin{large} -->
<!-- Licenciatura en Economía -->
<!-- \end{large} -->
<!-- \end{center} -->
<!-- \medskip -->
<!-- \vspace*{0in} -->
<!-- \begin{figure}[h!] -->
<!-- \begin{center} -->
<!-- \includegraphics[width=4cm]{pictures/logo} -->
<!-- \end{center} -->
<!-- \end{figure} -->
<!-- \begin{center} -->
<!-- \begin{Large} -->
<!-- Titulo  -->
<!-- \end{Large} -->
<!-- \end{center} -->
<!-- \vspace*{0.1in} -->
<!-- \begin{center} -->
<!-- \begin{large} -->
<!-- Mansilla, Kevin Gaston \\ -->
<!-- \end{large} -->
<!-- Director: .... -->
<!-- \end{center} -->
<!-- \vspace*{1in} -->
<!-- \begin{center} -->
<!-- Trabajo Final de la Carrera \\ -->
<!-- Fecha -->
<!-- \end{center} -->
<!-- \end{titlepage} -->


\newpage

\tableofcontents
\listoffigures
\listoftables

\newpage
\setcounter{page}{1}
\pagestyle{plain}
# Introducción

\newpage
# Breve revisión de la literatura

\newpage
# Metodología 

La autocorrelación espacial puede definirse como la similitud de valores en localizaciones próximas, ya sea positiva o negativa, su existencia implica que una muestra de datos contiene menor información que una muestra no correlacionada, formalmente: 
$$Cov(y_{i},y_{j}) = E(y_{i},y_{j}) - E(y_{i})(y_{j}) \neq 0\,\,\,\, \forall i\neq j$$
donde $y_{i}$, $y_{j}$ son observaciones de una variable aleatoria en la localización $i$ y $j$ en el espacio, es decir, todo par $(i,j)$ posee información geográfica específica media por latitud y longitud. 

@sokal1978spatial argumentaron que el análisis de autocorrelación espacial prueba si el valor observado de una variable nominal, ordinal o de intervalo en localidades independiente de los valores de esa misma variable en las localidades vecinas. 

Entonces se puede llegar a la conclusión de que, si el valor de una o varias variables en una ubicación son similares a los valores de dichas variables en ubicaciones cercanas, entonces se dice que el patrón en conjunto exhibe una autocorrelación espacial positiva.

Por el contrario, se dice que existe autocorrelación espacial negativa cuando las observaciones que están cerca en el espacio tienen a ser más diferentes en los valores de las variables que las observaciones que están más separadas.  

En los análisis de autocorrelación espacial se necesita una medida de contigüidad que podemos definirla de manera general como una relación de vecindad, estas pueden ser de tres tipos, caso de torre, caso de alfil y caso de la reina. Un aspecto crucial de la definición de la autocorrelación espacial es la determinación de las ubicaciones cercanas, es decir, aquellas ubicaciones que rodean un punto de datos que podría considerarse que influyen en la observación en ese punto de datos. 

Sin embargo, la determinación de este vecindario tiene un cierto grado de arbitrariedad. El número de observaciones en el vecindario establecido para cada ubicación puede expresarse mediante una matriz de ponderaciones $W$, que describe la conectividad entre n unidades que se encuentran localizadas en un espacio bidimensional.
\begin{equation*}
\begin{bmatrix}
W_{11} & W_{12} & \ldots & W_{1n}\\
W_{21} & W_{22} & \ldots & W_{2n}\\
\vdots & \vdots & \ddots & \vdots\\
W_{n1} & W_{n2} & \ldots & W_{nn}
\end{bmatrix}
\end{equation*}

donde $n$ representa el número de ubicaciones. La entrada en la fila $i$ y columna $j$, denotado como $W_{ij}$ corresponde al par $(i,j)$ de ubicaciones. Los elementos diagonales de la matriz son cero, por convenio, mientras que los demás elementos donde $i \neq j$ toman valores distintos de cero cuando las ubicaciones se consideran vecinas. 

Nosotros nos basaremos en la distancia euclídea (tipo reina), este método considera vecinas dos áreas si cumplen cierta propiedad referente a la distancia que las separa. Nos referimos a la distancia entre dos regiones como la distancia entre sus puntos representativos (centroides).  

Al establecer un centroide en cada provincia se detectó que en el caso de contigüidad tipo reina la provincia de tierra del fuego quedaba desconectada del resto, esto es porque esté criterio no obliga a los polígonos que se encuentran aislados geográficamente a relacionarse o conectarse con los demás.  Una solución común a este problema es restringir la estructura contigua a los $k-$vecinos más cercanos, en nuestro caso $k=4$, y por lo tanto excluir las 'islas' (áreas que por no estar a una distancia d de otra área se podría decir que no tiene vecinos) y forzar a cada unidad de área a tener el mismo número $k$ de vecinos. Formalmente 
\begin{displaymath}W_{ij} = \left\{ \begin{array}{ll}1 & \mbox{Si el centroide de $j$ es uno de los $k$ centroides más cercanos al de $i$} \\0 & \mbox{c.c}\end{array}\right.\end{displaymath}

Una vez definida la matriz de contactos, pueden utilizarse diferentes estadísticos univariantes que permiten detectar autocorrelación espacial. Los mismos pueden clasificarse como medidas de dependencia globales o locales. Las medidas globales utilizan la información completa del conjunto de datos con el fin de obtener un valor promedio para todo el espacio geográfico. Al resumir en un único valor toda la información, no es posible detectar la variabilidad de la dependencia ni la localización de estos patrones. Por su parte, las medidas locales examinan la autocorrelación espacial en un subconjunto de datos. 

A la hora de estudiar los datos espaciales, está puede estar presente en variables explicativas, variable dependiente o en los residuos del modelo. Cuando la dependencia se encuentra en la variable dependiendo los modelos se denominan modelos de retardo espacial mientras que si está en los residuos se denominan modelos de error espacial. Por otro lado, cuando se presenta en las variables explicativas se llaman modelos de regresión cruzada o modelos X espacialmente retardados. Entonces, lo que primero se hace es armar el modelo como si fuera una regresión lineal y ver dónde está la autocorrelación espacial y ver cuál es el modelo que mejor se ajusta.

Es por ello que presentaremos la prueba de @hausman1978specification, que permite decidir entre un modelo en el cual los efectos individuales no se correlacionan con las variables explicativas, este test determina qué método de estimación utilizar.  

La prueba de especificación de Hausman, puede aplicarse para probar el modelo de efectos aleatorios contra el modelo de efectos fijos. En nuestro caso, esta prueba se construye midiendo la brecha (ponderada por una matriz de varianza de covarianza) entre las estimaciones producidas por los estimadores dentro (modelo de efectos fijos) y GLS (modelo de efectos aleatorios) de los cuales se sabe que uno de los dos es convergente independientemente de la hipótesis formulada sobre la correlación entre variables y características inobservables, mientras que el otro (GLS) no converge en el único caso en el que esta hipótesis no se verifica. Por tanto, una diferencia significativa en ambas estimaciones implica una mala especificación del modelo de efectos aleatorios. 

@mutl2011hausman han demostrado que estas propiedades siguen siendo válidas en un entorno espacial al reemplazar cada estimador dentro y GLS por su "análogo" espacial (teniendo en cuenta los términos de autocorrelación espacial). La prueba robusta de Hausman de autocorrelación espacial está escrita: 
$$S_{hausman} = NT(\widehat{\beta}_{MCG} - \widehat{\beta}_{Within})' \left( \sum_{Within} - \sum_{MCG}\right)^{-1}(\widehat{\beta}_{MCG} - \widehat{\beta}_{Within})  $$
donde $\widehat{\beta}_{MCG}$ y $\widehat{\beta}_{Within}$ son los parametros estimados por GLS y within respectivamente, $\sum_{Within}-\sum_{MCG}$ se corresponden a las matriz de varianza y covarianzas de los dos estimadores.

A su vez, también presentaremos otros test que nos ayudaran a elegir la especificación más adecuada para estimar nuestro modelo, como los test I de Morán y Multiplicadores de lagrange. Por lo que partimos de un modelo estático (el más simple posible):
\begin{align*}
y = X\beta + \mu \\
\mu \sim (0, \sigma^{2} I_{n})
\end{align*}
siendo la variable dependiente $y$ un vector de dimensión $(n × 1)$, $X$ es una matriz de variables expicativas, incluyendo una constante, de orden $(n × k)$, $\beta$ es un vector de parámetros desconocidos de orden $(k × 1)$ y $\mu$ es el término de error de dimendición $(n × 1)$. 

La presencia de estructura espacial en el modelo anterior puede contrastarse en base a estadísticos simples que utilizan resultados de estimación por mínimos cuadrados ordinarios (MCO). Uno de estos contrastes es el test I de Moran que se aplica a los residuos del modelo, sugerido por @cliffspatial:
$$ I = \frac{n}{S_{0}} \frac{\widehat{u}' W \widehat{u}}{\widehat{u}'\widehat{u}}  $$
donde $\widehat{u}$ es el vector de residuos $MCO$, $n$ es el número de observaciones y $S_{0}$ es la suma de todos los elementos de $W$.

La hipótesis nula del contraste es no autocorrelación espacial. El problema con esté test es que el rechazo de la hipotesis nula no brinda información sobre el posible modelo a especificar dado que la hipotesis alternativa es general y no da una guía sobre el tipo de estructura espacial.

Como complemento, se emplea también el test de multiplicadores de Lagrange, LM, donde la hipótesis alternativa se encuentra bien definida y restringuida, estableciendo un modelo de error autoregresivo asumiendo que el término de error del modelo inicial se comporta de la siguiente forma:
$$u = \rho W \mu + \epsilon$$
donde $\rho$ es el parámetro espacial autoregresivo, $W$ es una matriz de pesos espaciales no estocástica de orden $(n × n)$ y $\epsilon$ es un vector de innovaciones con media nula y varianza constante 0,  $(\sigma^{2}I)$. Entonces, el test establece las siguientes hipótesis:
\begin{align*}
H_{0}: \rho = 0 \\
H_{1}: \rho \neq 0
\end{align*}
además su formula de calculo es:
$$LM_{error} = \frac{1}{T_{1}} \left(\frac{\widehat{u}' W \widehat{u}}{\widehat{\sigma}^{2}} \right)^{2}  \stackrel{as}{\sim} \chi^{2}_{(1)} $$
Donde $T_{1}$ es igual a $tr[(W'+ W)W]$ y $\widehat{u}$ son los residuos y $\widehat{\sigma}^{2} = \frac{\widehat{u}' \widehat{u}}{n}$

Una segunda hipótesis alternativa, planteando un modelo de rezago espacial (SLM), que incorpora un rezago espacial de la variable dependiente, $Wy$, como explicativa:
$$y = \lambda Wy + X\beta + \mu$$
donde $\lambda$ es un parámetro  espacial autoregresivo, $\mu$ es un vextor de errores de dimensión $(nx1)$ y $\mu \sim (0,\sigma^{2}I_{n})$. Las hipotesis que propone el test son las siguientes:
\begin{align*}
H_{0}: \lambda = 0, \\
H_{1}: \lambda \neq 0
\end{align*}
con la siguiente estructura:
$$LM_{LAG} = \frac{1}{n} \frac{\left(\frac{\widehat{u}' W \widehat{u}}{\widehat{\sigma}^{2}} \right)^{2}}{J_{\lambda \beta}}  \stackrel{as}{\sim} \chi^{2}_{(1)} $$
con $J_{\lambda \beta} = \frac{1}{n \sigma^{2}}[(W X \beta)' M (W X \beta) + T_{1}\sigma^{2}]$, con $M = I - (X' X)^{-1} X'$.

Según @gmez_2017_fundamentals estos contrastes LM presentan como inconveniente que son sensibles a diferentes tipos de errores de especificación. Por ejemplo, el $LM_{ERROR}$ detecta autocorrelación espacial debido a la presencia de un rezago espacial de la variable endógena $(Wy)$, y lo mismo puede decirse del $LM_{LAG}$, que brinda falsos positivos cuando el término de error contiene un rezago espacial $(Wu)$. Es por ello que Anselin et al. (1996) proponen dos nuevos multiplicadores de Lagrande que se caracterizan por ser más robustos a los errores de especificación.

EL $LM^{*}_{ERROR}$ analiza la falta de correlación en los residuos, siendo robusto a la omisión del término $Wy$:
$$LM^{*}_{ERROR} = \frac{\left[\left(\frac{\widehat{u}' W \widehat{u}}{\widehat{\sigma}^{2}} \right) - \left(\frac{\widehat{u}' W \widehat{u}}{\widehat{\sigma}^{2}} \right)\right]^{2}}{n \widehat{J}_{\lambda \beta} -T_{1}}  \stackrel{as}{\sim} \chi^{2}_{(1)} $$
Y el $LM^{*}_{LAG}$ permite detectar la autocorrelación espacial en presencia de estructura espacial en el término de error:
$$LM^{*}_{LAG} = \frac{\left(\frac{\widehat{u}' W \widehat{u}}{\widehat{\sigma}^{2}} \right) - T_{1}(\widehat{J}_{\lambda \beta})^{-1} \left(\frac{\widehat{u}' W y}{\widehat{\sigma}^{2}} \right)}{n \widehat{J}_{\lambda \beta} -T_{1}}  \stackrel{as}{\sim} \chi^{2}_{(1)}$$
Estos contrastes permiten incorporar evariantes espaciales en base al rechazo o no de cada una de las hipótesis nulas. en base a la siguientes estrategía:

\begin{itemize}
\item Si $I$ de Moran rechaza $H0$ hay evidencia a favor de inclusión de elementos espaciales.
\item Si $LM_{ERROR}$ y $LM^{*}_{ERROR}$ rechazan $H0$ hay evidencia a favor de un modelo de error espacial $(SEM)$.
\item Si $LM_{LAG}$ y $LM^{*}_{LAG}$ rechazan $H0$ hay evidencia a favor de un modelo de rezagoespacial $(SLM)$.
\item Si no se rechaza $H0$ bajo ninguno de los contrastes, entonces hay evidencia a favor delmodelo lineal general no espacial.
\item Si ambos contrastes robustos, $LM_{ERROR}$ y $LM^{*}_{LAG}$, rechazan $H0$ entonces se deberán incorporar elementos espaciales en la parte sistemática $(Wy)$ y aleatoria $(Wu)$.
\end{itemize}

El modelo a implementar es el espacial autoregresivo, formalmente se presenta la siguiente manera:
$$y_{it} = \rho \sum_{i \neq j} w_{ij}y_{jt} + x_{it}\beta + \alpha_{i} + \mu_{it}$$
donde $u_{it} \stackrel{iid}{\sim} N(0, \sigma^{2})$. La interacción espacial aquí se modela a través de la introducción de la variable dependiente espacialmente rezagada $\sum_{i \neq j} w_{ij}y_{jt}$. Al igual que en los modelos de sección transversal, la introducción de este variable conlleva efectos secundarios globales: en promedio, el valor de y en el tiempo $t$ para la observación $i$ es explicado no solo por los valores de las variables explicativas de esta observación, sino también por aquellos asociado con todas las observaciones (vecino i o de otro tipo). También está en juego un efecto de derrame espacial global: un choque aleatorio en una observación $i$ en el tiempo $t$ afecta no solo el valor de y de esta observación en el mismo período, sino que también tiene un efecto en la valores de y de otras observaciones.

\newpage
# Datos

\begin{figure}[h!]
\caption{\textbf{Distribución geografica de las universidades.}}
\center
\includegraphics[width=0.4\textwidth]{pictures/Rplot02.pdf}
\begin{center}
\begin{scriptsize}
\textit{Fuente: Elaboraci\'on propia.}
\end{scriptsize}
\end{center}
\label{F:uni2}
\end{figure}

\newpage
# Resultados

Nuestra aplicación como se mensionó anteriormente consiste en determinal la relación que tienen aumento en la población y el número de universidades de cada provincia, con el producto bruto regional. Entonces, la especificación inicial está dada por:
$$PBG_{it} = b_{0} + b_{1}\,\,POB_{it} + b_{2}\,\, \#universidades_{it} + \epsilon_{it}$$
donde $b_{0}$, $b_{1}$, $b_{2}$ son los parámetros desconocidos a estimar y $\epsilon_{it}$ es un término de error para el cual
$i.i.d$. inicialmente suponga que $\epsilon_{it} \sim N(0, \sigma^{2})$.

Para tener en cuenta los efectos espaciales es necesario estimar la especificación aumentada por un término autorregresivo espacial [@fingleton2000spatial], vinculando  un error autorregresivo espacial
modelo:
$$PBG_{it} = b_{0} + b_{1}\,\,POB_{it} + b_{2}\,\, \#universidades_{it} + \epsilon_{it}$$
$$\epsilon_{it} = \alpha_{i} + \lambda \sum_{i \neq j} w_{ij}\epsilon_{jt} + v_{it}$$
Para seleccionar la especificación más adecuada, partimos del modelo sin autocorrección espacial, e implementamos la prueba de Hausman y las pruebas del multiplicador de Lagrange a los residuos del los modelos. En la tabla \ref{tab:model_ini}, muestra los resultados de la estimación donde en la columna (1) se observa un modelo de datos agrupados (pooled), mientras que las columnas (2) y (3) tienen en cuenta los datos no observados heterogeneidad individual, respectivamente, a través de efectos fijos y efectos aleatorios.  (escribir alguna explicación breve sobre las estimaciones).

\begin{table}[h!]
\caption{Estimación sin considerar autocorrelación espacial}
\label{tab:model_ini}
\begin{tabular}{@{}cccc@{}}
\toprule
Model              & pooled (1)  & fixed effets(within) (2) & random effects (GLS) (3) \\ \midrule
$b_{0}$ (intercep) & 4.418634*** & -                        & -3.422275**              \\
log(Pob)           & 0.682238*** & 8.712956***              & 1.842667***              \\
\#Universidades    & 0.264833*** & 0.106046***              & 0.273810***              \\
Observaciones      & 624         & 624                      & 624                      \\
$R^{2}$ ajustado   & 0.47102     & 0.72179                  & 0.332                    \\ \bottomrule
\end{tabular}
\begin{scriptsize}
\textit{Fuente: Elaboraci\'on propia.}
\end{scriptsize}
\end{table}

Por otro lado la prueba estándar de Hausman y su versión robusta para la detección de autocorrelación espacial de errores que se presenta en la tabla \ref{tab:hausman}, conduce al rechazo de la hipótesis nula sobre la ausencia de correlación entre efectos y variables explicativas.  Por lo que se elige un modelo de efectos fijo.

\begin{table}[h!]
\caption{Prueba de Hausman}
\label{tab:hausman}
\begin{tabular}{@{}cccc@{}}
\toprule
Modelo            & Pooled(1) & fixed effects(within) (2) & random effects (GLS) (3) \\ \midrule
Estadistico chi 2 & 1316.3*** & 35.043***                 & 17.048***                \\ \bottomrule
\end{tabular}
\begin{scriptsize}
\textit{Fuente: Elaboraci\'on propia.}
\end{scriptsize}
\end{table}

Por otro lado, en la tabla \ref{tab:lm}, se exponen los resultados de las pruebas de los multiplicador de Lagrange (LM) en un modelo de efectos fijos, los cuales tienden a favorecer una especificación SAR del modelo. 

Los estadisticos de la prueba para tomar la autocorrelación espacial por SAR (Prueba 1) o SEM (Prueba 2) confirman el rechazo de la hipótesis de que estos dos términos (tomados independientemente) son nulos, la lectura simultánea nos permite concluir sobre la especificación más adecuada para tener en cuenta la autocorrelación espacial. Para concluir de una manera más creíble, se utilizan pruebas robustas en la presencia de la especificación alternativa de autocorrelación espacial (Pruebas 3 y 4).

La versión robusta de $LM_{ERROR}$ no es significativa (Prueba 4) mientras que $LM_{LAG}$ si lo es (Prueba 3). Por lo tanto, es conveniente estimar un modelo Fixed-effect SAR. (poner en pie de página tal vez: En algunos casos, estas dos últimaspruebas robustas no permiten discriminar entre un SAR y un SEM. Son posibles varias posibilidades. El primero consiste en estimar un modelo que contiene ambos términosespaciales (SARAR). ))

\begin{table}[h!]
\caption{test LM y LM*}
\label{tab:lm}
\begin{tabular}{@{}cccc@{}}
\toprule
$LM_{LAG}$ (prueba 1) & $LM_{Error}$ (prueba 2) & $LM^{*}_{LAG}$ (prueba 3) & $LM^{*}_{Error}$ (prueba 4) \\ \midrule
807.74***          & 541.03***            & 267.46***           & 0.74516               \\ \bottomrule
\end{tabular}
\begin{scriptsize}
\textit{Fuente: Elaboraci\'on propia.}
\end{scriptsize}
\end{table}

Entonces, teniendo en cuenta las concluciones de los test que ayudan a mejorar la especificación del modelo tenemos los resultados del mismo en la tabla \ref{tab:modelos}. La columna (1) muestra el modelo de datos agrupados, mientras que en la columna (2) se exponen los resultados del modelo de efecto fijos con diferencias en la espacificación del término de error. Podemos observar que el coeficiente de autocorrelación es positivo y significativo.

En cuanto a los coeficientes estimados, llegamos a la conclución de que tanto log(POB) y $\#universidades$ son significativos, por lo que el aumento de la población tiene un impacto positivo en el pbg, al igual que la creación de nuevas universidades, pero en menor medida. 


\begin{table}[h!]
\caption{Modelo}
\centering
\label{tab:modelos}
\begin{tabular}{@{}ccc@{}}
\toprule
Model              & pooled (1)   & fixed effects(MV) (2) \\ \midrule
$b_{0}$ (intercep) & 6.408201***  & -                     \\
log(Pob)           & 0.863431***  & 0.0718612*            \\
\#universidades    & 0.068693 *** & 0.0160614***          \\
$\lambda$          & -            & 0.9770277***          \\
Observaciones      & 624          & 624                   \\ \bottomrule
\end{tabular}

\begin{scriptsize}
\textit{Fuente: Elaboraci\'on propia.}
\end{scriptsize}
\end{table}


\newpage
# Conclusiones preliminares


\newpage
# Bibliografía


